<!doctype html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Kalendarz adwentowy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #020617;
      --card-front: #111827;
      --card-front-hover: #1f2937;
      --accent: #f97316;
      --accent-soft: rgba(248, 164, 76, 0.2);
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --locked: #4b5563;
      --open-border: #22c55e;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #020617, #020617 60%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    .app {
      width: 100%;
      max-width: 480px; /* dalej wyglƒÖda dobrze na szerszych ekranach */
      padding: 12px 8px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    header {
      text-align: center;
    }

    header h1 {
      margin: 0;
      font-size: 1.3rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    header p {
      margin: 4px 0 0;
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .calendar-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .calendar-grid {
      flex: 1;
      display: grid;
      /* 6 (wysoko≈õƒá) x 4 (szeroko≈õƒá) */
      grid-template-rows: repeat(6, 1fr);
      grid-template-columns: repeat(4, 1fr);
      gap: 0; /* pola stykajƒÖ siƒô bez przerw */
      border-radius: 16px;
      overflow: hidden; /* ≈ºeby rogi by≈Çy r√≥wne */
      background: #020617;
    }

    .card {
      position: relative;
      width: 100%;
      height: 100%;
      border: none;
      padding: 0;
      background: transparent;
      cursor: pointer;
    }

    .card.locked {
      cursor: not-allowed;
    }

    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
    }

    .card-face {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid #020617; /* delikatne linie miƒôdzy polami */
    }

    .card-front {
      background: radial-gradient(circle at top, #1f2937, #020617);
      flex-direction: column;
      gap: 4px;
      transition: background 0.15s, transform 0.15s, opacity 0.2s;
    }

    .card:not(.locked):not(.is-open):hover .card-front {
      background: var(--card-front-hover);
      transform: translateY(-1px);
    }

    .card.locked .card-front {
      background: #020617;
      border-color: #020617;
      opacity: 0.6;
    }

    .day-number {
      font-size: 1.1rem;
      font-weight: 700;
    }

    .card.locked .day-number {
      color: var(--locked);
    }

    .label {
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.13em;
      color: var(--text-muted);
    }

    .available-pill {
      padding: 2px 6px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      font-size: 0.6rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .card.locked .available-pill {
      display: none;
    }

    .card-back {
      opacity: 0;
      pointer-events: none;
      background-size: 400% 600%; /* 4 kolumny (szer.), 6 rzƒôd√≥w (wys.) */
      background-repeat: no-repeat;
      transition: opacity 0.25s;
      align-items: stretch;
      justify-content: stretch;
    }

    .card-back-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(
        to top,
        rgba(15, 23, 42, 0.9),
        rgba(15, 23, 42, 0.15)
      );
    }

    .back-content {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      padding: 5px;
      font-size: 0.7rem;
      line-height: 1.2;
    }

    .back-day-label {
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      opacity: 0.9;
      margin-bottom: 2px;
    }

    .back-message {
      font-size: 0.7rem;
    }

    /* Po otwarciu poka≈º ty≈Ç, schowaj prz√≥d */
    .card.is-open .card-front {
      opacity: 0;
      pointer-events: none;
    }

    .card.is-open .card-back {
      opacity: 1;
      pointer-events: auto;
      border: 1px solid rgba(34, 197, 94, 0.7);
    }

    .status-bar {
      font-size: 0.75rem;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .progress {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .progress-pill {
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-size: 0.7rem;
    }

    .date-info {
      font-feature-settings: "tnum";
    }

    .wiggle {
      animation: wiggle 0.35s ease;
    }

    @keyframes wiggle {
      0% { transform: translateX(0); }
      25% { transform: translateX(-2px); }
      50% { transform: translateX(2px); }
      75% { transform: translateX(-1px); }
      100% { transform: translateX(0); }
    }
  </style>
</head>
<body>
  <main class="app">
    <header>
      <h1>Kalendarz adwentowy</h1>
      <p>Dotykaj okienek, kiedy przyjdzie ich grudniowy dzie≈Ñ. üéÑ</p>
    </header>

    <section class="calendar-wrapper">
      <div id="calendar" class="calendar-grid" aria-label="Kalendarz adwentowy"></div>

      <div class="status-bar">
        <div class="progress">
          <span id="progressText">0 / 24 otwartych</span>
          <span class="progress-pill" id="todayInfo"></span>
        </div>
        <span class="date-info" id="dateInfo"></span>
      </div>
    </section>
  </main>

  <script>
    // === USTAWIENIA DO PODMIANY ===

    // Podmie≈Ñ na swojƒÖ grafikƒô w repo, np. "img/obrazek.jpg"
    const IMAGE_URL = "./img/moje_zdjecie.jpg";

    // Teksty pod ka≈ºdym dniem (24 wpisy)
    const messages = [
      "Dzisiejsza misja: ma≈Çy u≈õmiech dla kogo≈õ obok.",
      "Wypij kubek czego≈õ ciep≈Çego i odetchnij g≈Çƒôboko.",
      "Zr√≥b jednƒÖ drobnƒÖ rzecz, kt√≥rƒÖ odk≈Çadasz od dawna.",
      "Powiedz komu≈õ bliskiemu co≈õ mi≈Çego ‚Äì konkretnie.",
      "5 minut totalnego resetu od telefonu.",
      "Zapisz jednƒÖ rzecz, z kt√≥rej jeste≈õ dumna/dumny.",
      "Wy≈õlij g≈Çupawego mema do przyjaciela.",
      "Spacer choƒáby 10 minut ‚Äì serio.",
      "Pos≈Çuchaj ulubionej piosenki z pe≈Çnym skupieniem.",
      "Zr√≥b komu≈õ niespodziewanƒÖ, drobnƒÖ przys≈Çugƒô.",
      "Daj sobie prawo dzi≈õ czego≈õ nie robiƒá.",
      "Zr√≥b porzƒÖdek w jednym ma≈Çym miejscu.",
      "Zapisz trzy rzeczy, za kt√≥re jeste≈õ wdziƒôczna/wdziƒôczny.",
      "Zr√≥b co≈õ kreatywnego przez 10 minut.",
      "Napisz wiadomo≈õƒá do kogo≈õ, z kim dawno nie gada≈Ça≈õ/gada≈Çe≈õ.",
      "Pomy≈õl, co dobrego zrobi≈Çe≈õ w tym roku.",
      "Zr√≥b przerwƒô na przeciƒÖganie i g≈Çƒôboki wdech.",
      "Zaplanuj jednƒÖ przyjemnƒÖ rzecz po sesji/pracy.",
      "Zr√≥b sobie ma≈Çy, symboliczny prezent.",
      "Wieczorem od≈Ç√≥≈º telefon na 30 minut.",
      "Zr√≥b screen tego okienka na pamiƒÖtkƒô üòâ",
      "Przytul kogo≈õ (albo poduszkƒô, te≈º siƒô liczy).",
      "Pomy≈õl, co chcesz zabraƒá ze sobƒÖ w nowy rok.",
      "Dziƒôkujƒô, ≈ºe dotar≈Ça≈õ/e≈õ do 24. ‚ù§Ô∏è"
    ];

    const ROWS = 6;  // wysoko≈õƒá
    const COLS = 4;  // szeroko≈õƒá
    const TOTAL_DAYS = 24;
    const STORAGE_KEY = "advent-calendar-opened-2025";

    function getCurrentDayForCalendar() {
      const now = new Date();
      let day = 0;

      // Grudzie≈Ñ ma indeks 11 (0 = stycze≈Ñ)
      if (now.getMonth() === 11) {
        day = Math.min(now.getDate(), TOTAL_DAYS);
      }

      // Tryb debug: ?debugDay=10
      const params = new URLSearchParams(window.location.search);
      const debugDay = parseInt(params.get("debugDay"), 10);
      if (!isNaN(debugDay)) {
        return Math.max(0, Math.min(debugDay, TOTAL_DAYS));
      }

      return day;
    }

    function loadOpenedFromStorage() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return new Set();
        const arr = JSON.parse(raw);
        return new Set(arr);
      } catch {
        return new Set();
      }
    }

    function saveOpenedToStorage(set) {
      const arr = Array.from(set);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
    }

    function updateStatusBar(openedSet, currentDay) {
      const progressText = document.getElementById("progressText");
      const todayInfo = document.getElementById("todayInfo");
      const dateInfo = document.getElementById("dateInfo");

      progressText.textContent = `${openedSet.size} / ${TOTAL_DAYS} otwartych`;

      if (currentDay === 0) {
        todayInfo.textContent = "Odpalamy od 1 grudnia üéÅ";
      } else {
        todayInfo.textContent = `Dostƒôpne okienka: 1‚Äì${currentDay}`;
      }

      const now = new Date();
      const options = { day: "2-digit", month: "2-digit", year: "numeric" };
      dateInfo.textContent = now.toLocaleDateString("pl-PL", options);
    }

    function createCalendar() {
      const container = document.getElementById("calendar");

      // --- RESET PRZEZ PARAMETR W URL: ?reset=1 ---
      const url = new URL(window.location.href);
      const params = url.searchParams;

      if (params.get("reset") === "1") {
        // Czy≈õcimy zapisane okienka dla tego urzƒÖdzenia
        localStorage.removeItem(STORAGE_KEY);

        // Usuwamy parametr z URL, ≈ºeby reset nie powtarza≈Ç siƒô przy ka≈ºdym od≈õwie≈ºeniu
        params.delete("reset");
        const newUrl =
          url.pathname + (params.toString() ? "?" + params.toString() : "");
        window.history.replaceState({}, "", newUrl);
      }
      
      const currentDay = getCurrentDayForCalendar();
      const openedSet = loadOpenedFromStorage();

      container.innerHTML = "";

      for (let i = 0; i < TOTAL_DAYS; i++) {
        const dayNumber = i + 1;
        const row = Math.floor(i / COLS);
        const col = i % COLS;

        const card = document.createElement("button");
        card.className = "card";
        card.setAttribute("type", "button");
        card.setAttribute("aria-label", `Okienko ${dayNumber}`);
        card.dataset.day = String(dayNumber);

        const cardInner = document.createElement("div");
        cardInner.className = "card-inner";

        // FRONT
        const front = document.createElement("div");
        front.className = "card-face card-front";

        const daySpan = document.createElement("span");
        daySpan.className = "day-number";
        daySpan.textContent = String(dayNumber);

        const label = document.createElement("span");
        label.className = "label";
        label.textContent = "Dotknij, aby odkryƒá";

        const availablePill = document.createElement("span");
        availablePill.className = "available-pill";
        availablePill.textContent = "Dostƒôpne";

        front.appendChild(daySpan);
        front.appendChild(label);
        front.appendChild(availablePill);

        // BACK (grafika + tekst)
        const back = document.createElement("div");
        back.className = "card-face card-back";
        back.style.backgroundImage = `url('${IMAGE_URL}')`;

        // Ustawienie fragmentu grafiki: 4 kolumny, 6 rzƒôd√≥w
        const xPos = (col / (COLS - 1)) * 100;
        const yPos = (row / (ROWS - 1)) * 100;
        back.style.backgroundPosition = `${xPos}% ${yPos}%`;

        const overlay = document.createElement("div");
        overlay.className = "card-back-overlay";

        const backContent = document.createElement("div");
        backContent.className = "back-content";

        const backDayLabel = document.createElement("div");
        backDayLabel.className = "back-day-label";
        backDayLabel.textContent = `${dayNumber}. grudnia`;

        const backMessage = document.createElement("div");
        backMessage.className = "back-message";
        backMessage.textContent = messages[i] || "";

        backContent.appendChild(backDayLabel);
        backContent.appendChild(backMessage);
        back.appendChild(overlay);
        back.appendChild(backContent);

        cardInner.appendChild(front);
        cardInner.appendChild(back);
        card.appendChild(cardInner);
        container.appendChild(card);

        const alreadyOpen = openedSet.has(dayNumber);
        if (alreadyOpen) {
          card.classList.add("is-open");
        }

        const isLocked = dayNumber > currentDay;
        if (isLocked) {
          card.classList.add("locked");
        }

        card.addEventListener("click", () => {
          const nowDay = getCurrentDayForCalendar();

          if (dayNumber > nowDay) {
            card.classList.remove("wiggle");
            void card.offsetWidth; // reset animacji
            card.classList.add("wiggle");
            return;
          }

          if (card.classList.contains("is-open")) {
            return; // jednokierunkowo: jak otwarte, to otwarte
          }

          card.classList.add("is-open");
          openedSet.add(dayNumber);
          saveOpenedToStorage(openedSet);
          updateStatusBar(openedSet, nowDay);
        });
      }

      updateStatusBar(openedSet, currentDay);
    }

    createCalendar();
  </script>
</body>
</html>
