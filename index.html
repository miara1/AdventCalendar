<!doctype html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Kalendarz adwentowy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #020617;
      --card-front: #111827;
      --card-front-hover: #1f2937;
      --accent: #f97316;
      --accent-soft: rgba(248, 164, 76, 0.2);
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --locked: #4b5563;
      --open-border: #22c55e;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #020617, #020617 60%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    .app {
      width: 100%;
      max-width: 480px;
      padding: 12px 8px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    header {
      text-align: center;
    }

    header h1 {
      margin: 0;
      font-size: 1.3rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    header p {
      margin: 4px 0 0;
      font-size: 0.82rem;
      color: var(--text-muted);
    }

    .calendar-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .calendar-grid {
      flex: 1;
      display: grid;
      /* 6 (wysokoÅ›Ä‡) x 4 (szerokoÅ›Ä‡) */
      grid-template-rows: repeat(6, 1fr);
      grid-template-columns: repeat(4, 1fr);
      gap: 0;
      border-radius: 16px;
      overflow: hidden;
      background: #020617;
    }

    .card {
      position: relative;
      width: 100%;
      height: 100%;
      border: none;
      padding: 0;
      background: transparent;
      cursor: pointer;
    }

    .card.locked {
      cursor: not-allowed;
    }

    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
    }

    .card-face {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid #020617; /* delikatne linie miÄ™dzy polami */
    }

    .card-front {
      background: radial-gradient(circle at top, #1f2937, #020617);
      flex-direction: column;
      gap: 4px;
      transition: background 0.15s, transform 0.15s, opacity 0.2s;
    }

    .card:not(.locked):not(.is-open):hover .card-front {
      background: var(--card-front-hover);
      transform: translateY(-1px);
    }

    .card.locked .card-front {
      background: #020617;
      border-color: #020617;
      opacity: 0.6;
    }

    .day-number {
      font-size: 1.15rem;
      font-weight: 800;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .card.locked .day-number {
      color: var(--locked);
    }

    .label {
      font-size: 0.64rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-muted);
    }

    .available-pill {
      padding: 2px 6px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      font-size: 0.6rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .card.locked .available-pill {
      display: none;
    }

    .card-back {
      opacity: 0;
      pointer-events: none;
      background-size: 400% 600%; /* 4 kolumny (szer.), 6 rzÄ™dÃ³w (wys.) */
      background-repeat: no-repeat;
      transition: opacity 0.25s;
      align-items: stretch;
      justify-content: stretch;
    }

    .card-back-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(
        to top,
        rgba(15, 23, 42, 0.9),
        rgba(15, 23, 42, 0.15)
      );
    }

    .back-content {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      padding: 6px;
      font-size: 0.72rem;
      line-height: 1.3;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.7);
    }

    .back-day-label {
      font-size: 0.66rem;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      opacity: 0.9;
      color: #facc15;
      margin-bottom: 2px;
    }

    .back-message {
      font-size: 0.78rem;
      font-weight: 500;
    }

    .card.is-open .card-front {
      opacity: 0;
      pointer-events: none;
    }

    .card.is-open .card-back {
      opacity: 1;
      pointer-events: auto;
      border: 1px solid rgba(34, 197, 94, 0.7);
    }

    .status-bar {
      font-size: 0.75rem;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .progress {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .progress-pill {
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-size: 0.7rem;
    }

    .date-info {
      font-feature-settings: "tnum";
    }

    .wiggle {
      animation: wiggle 0.35s ease;
    }

    @keyframes wiggle {
      0% { transform: translateX(0); }
      25% { transform: translateX(-2px); }
      50% { transform: translateX(2px); }
      75% { transform: translateX(-1px); }
      100% { transform: translateX(0); }
    }
  </style>
</head>
<body>
  <main class="app">
    <header>
      <h1>Kalendarz adwentowy</h1>
      <p>Dotykaj okienek, kiedy przyjdzie ich grudniowy dzieÅ„. ðŸŽ„</p>
    </header>

    <section class="calendar-wrapper">
      <div id="calendar" class="calendar-grid" aria-label="Kalendarz adwentowy"></div>

      <div class="status-bar">
        <div class="progress">
          <span id="progressText">0 / 24 otwartych</span>
          <span class="progress-pill" id="todayInfo"></span>
        </div>
        <span class="date-info" id="dateInfo"></span>
      </div>
    </section>
  </main>

  <!-- Konfetti z CDN (bez konfiguracji builda) -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

  <script>
    // === USTAWIENIA DO PODMIANY ===

    // PodmieÅ„ na swojÄ… grafikÄ™ w repo, np. "img/obrazek.jpg"
    const IMAGE_URL = "img/advent-background.jpg";

    // Teksty pod kaÅ¼dym dniem (24 wpisy)
    const messages = [
      "Dzisiejsza misja: maÅ‚y uÅ›miech dla kogoÅ› obok.",
      "Wypij kubek czegoÅ› ciepÅ‚ego i odetchnij gÅ‚Ä™boko.",
      "ZrÃ³b jednÄ… drobnÄ… rzecz, ktÃ³rÄ… odkÅ‚adasz od dawna.",
      "Powiedz komuÅ› bliskiemu coÅ› miÅ‚ego â€“ konkretnie.",
      "5 minut totalnego resetu od telefonu.",
      "Zapisz jednÄ… rzecz, z ktÃ³rej jesteÅ› dumna/dumny.",
      "WyÅ›lij gÅ‚upawego mema do przyjaciela.",
      "Spacer choÄ‡by 10 minut â€“ serio.",
      "PosÅ‚uchaj ulubionej piosenki z peÅ‚nym skupieniem.",
      "ZrÃ³b komuÅ› niespodziewanÄ…, drobnÄ… przysÅ‚ugÄ™.",
      "Daj sobie prawo dziÅ› czegoÅ› nie robiÄ‡.",
      "ZrÃ³b porzÄ…dek w jednym maÅ‚ym miejscu.",
      "Zapisz trzy rzeczy, za ktÃ³re jesteÅ› wdziÄ™czna/wdziÄ™czny.",
      "ZrÃ³b coÅ› kreatywnego przez 10 minut.",
      "Napisz wiadomoÅ›Ä‡ do kogoÅ›, z kim dawno nie gadaÅ‚aÅ›/gadaÅ‚eÅ›.",
      "PomyÅ›l, co dobrego zrobiÅ‚eÅ› w tym roku.",
      "ZrÃ³b przerwÄ™ na przeciÄ…ganie i gÅ‚Ä™boki wdech.",
      "Zaplanuj jednÄ… przyjemnÄ… rzecz po sesji/pracy.",
      "ZrÃ³b sobie maÅ‚y, symboliczny prezent.",
      "Wieczorem odÅ‚Ã³Å¼ telefon na 30 minut.",
      "ZrÃ³b screen tego okienka na pamiÄ…tkÄ™ ðŸ˜‰",
      "Przytul kogoÅ› (albo poduszkÄ™, teÅ¼ siÄ™ liczy).",
      "PomyÅ›l, co chcesz zabraÄ‡ ze sobÄ… w nowy rok.",
      "DziÄ™kujÄ™, Å¼e dotarÅ‚aÅ›/eÅ› do 24. â¤ï¸"
    ];

    const ROWS = 6;  // wysokoÅ›Ä‡
    const COLS = 4;  // szerokoÅ›Ä‡
    const TOTAL_DAYS = 24;
    const STORAGE_KEY = "advent-calendar-opened-2025";

    function getCurrentDayForCalendar() {
      const now = new Date();
      let day = 0;

      // GrudzieÅ„ ma indeks 11 (0 = styczeÅ„)
      if (now.getMonth() === 11) {
        day = Math.min(now.getDate(), TOTAL_DAYS);
      }

      // Tryb debug: ?debugDay=10
      const params = new URLSearchParams(window.location.search);
      const debugDay = parseInt(params.get("debugDay"), 10);
      if (!isNaN(debugDay)) {
        return Math.max(0, Math.min(debugDay, TOTAL_DAYS));
      }

      return day;
    }

    function loadOpenedFromStorage() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return new Set();
        const arr = JSON.parse(raw);
        return new Set(arr);
      } catch {
        return new Set();
      }
    }

    function saveOpenedToStorage(set) {
      const arr = Array.from(set);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
    }

    function updateStatusBar(openedSet, currentDay) {
      const progressText = document.getElementById("progressText");
      const todayInfo = document.getElementById("todayInfo");
      const dateInfo = document.getElementById("dateInfo");

      progressText.textContent = `${openedSet.size} / ${TOTAL_DAYS} otwartych`;

      if (currentDay === 0) {
        todayInfo.textContent = "Odpalamy od 1 grudnia ðŸŽ";
      } else {
        todayInfo.textContent = `DostÄ™pne okienka: 1â€“${currentDay}`;
      }

      const now = new Date();
      const options = { day: "2-digit", month: "2-digit", year: "numeric" };
      dateInfo.textContent = now.toLocaleDateString("pl-PL", options);
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function fireConfetti() {
      if (typeof confetti === "function") {
        confetti({
          particleCount: 70,
          spread: 60,
          origin: { y: 0.2 }
        });
      }
    }

    function createCalendar() {
      const container = document.getElementById("calendar");
      const currentDay = getCurrentDayForCalendar();
      const openedSet = loadOpenedFromStorage();

      container.innerHTML = "";

      // Losowa kolejnoÅ›Ä‡ numerkÃ³w 1â€“24
      const days = Array.from({ length: TOTAL_DAYS }, (_, i) => i + 1);
      const shuffledDays = shuffle(days);

      for (let i = 0; i < TOTAL_DAYS; i++) {
        const dayNumber = shuffledDays[i];

        // i = pozycja w siatce (obrazek), row/col = KAFEL na obrazku
        const row = Math.floor(i / COLS);
        const col = i % COLS;

        const card = document.createElement("button");
        card.className = "card";
        card.setAttribute("type", "button");
        card.setAttribute("aria-label", `Okienko ${dayNumber}`);
        card.dataset.day = String(dayNumber);

        const cardInner = document.createElement("div");
        cardInner.className = "card-inner";

        // FRONT (z numerkiem â€“ losowo rozmieszczony)
        const front = document.createElement("div");
        front.className = "card-face card-front";

        const daySpan = document.createElement("span");
        daySpan.className = "day-number";
        daySpan.textContent = String(dayNumber);

        const label = document.createElement("span");
        label.className = "label";
        label.textContent = "Dotknij, aby odkryÄ‡";

        const availablePill = document.createElement("span");
        availablePill.className = "available-pill";
        availablePill.textContent = "DostÄ™pne";

        front.appendChild(daySpan);
        front.appendChild(label);
        front.appendChild(availablePill);

        // BACK (kawaÅ‚ek wspÃ³lnej grafiki + tekst)
        const back = document.createElement("div");
        back.className = "card-face card-back";
        back.style.backgroundImage = `url('${IMAGE_URL}')`;

        // Ten fragment grafiki zawsze zaleÅ¼y od pozycji kafelka (i),
        // wiÄ™c caÅ‚y obrazek zÅ‚oÅ¼y siÄ™ poprawnie po odkryciu wszystkich okienek.
        const xPos = (col / (COLS - 1)) * 100;
        const yPos = (row / (ROWS - 1)) * 100;
        back.style.backgroundPosition = `${xPos}% ${yPos}%`;

        const overlay = document.createElement("div");
        overlay.className = "card-back-overlay";

        const backContent = document.createElement("div");
        backContent.className = "back-content";

        const backDayLabel = document.createElement("div");
        backDayLabel.className = "back-day-label";
        backDayLabel.textContent = `${dayNumber}. grudnia`;

        const backMessage = document.createElement("div");
        backMessage.className = "back-message";
        backMessage.textContent = messages[dayNumber - 1] || "";

        backContent.appendChild(backDayLabel);
        backContent.appendChild(backMessage);
        back.appendChild(overlay);
        back.appendChild(backContent);

        cardInner.appendChild(front);
        cardInner.appendChild(back);
        card.appendChild(cardInner);
        container.appendChild(card);

        const alreadyOpen = openedSet.has(dayNumber);
        if (alreadyOpen) {
          card.classList.add("is-open");
        }

        const isLocked = dayNumber > currentDay;
        if (isLocked) {
          card.classList.add("locked");
        }

        card.addEventListener("click", () => {
          const nowDay = getCurrentDayForCalendar();

          if (dayNumber > nowDay) {
            card.classList.remove("wiggle");
            void card.offsetWidth;
            card.classList.add("wiggle");
            return;
          }

          if (card.classList.contains("is-open")) {
            return;
          }

          card.classList.add("is-open");
          openedSet.add(dayNumber);
          saveOpenedToStorage(openedSet);
          updateStatusBar(openedSet, nowDay);
          fireConfetti();
        });
      }

      updateStatusBar(openedSet, currentDay);
    }

    createCalendar();
  </script>
</body>
</html>
